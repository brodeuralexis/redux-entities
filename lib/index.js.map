{"version":3,"file":"index.js","sources":["../src/state.ts","../src/actions.ts","../src/reducer.ts","../src/create-actions.ts","../src/create-action-matchers.ts","../src/selectors.ts","../src/create-selectors.ts","../src/index.ts"],"sourcesContent":["/**\r\n * The key to use for this module.\r\n */\r\nexport const entitiesKey = Symbol('entities')\r\n\r\nexport type Type = string | symbol\r\n\r\n/**\r\n * The part of the state this module knows about.\r\n */\r\nexport type State = {\r\n  [entitiesKey]: EntitiesState\r\n}\r\n\r\n/**\r\n * The structure of the state associated with the reducer.\r\n */\r\nexport type EntitiesState = {\r\n  [type: string]: Entities\r\n}\r\n\r\n/**\r\n * The map of entities.\r\n */\r\nexport type Entities = {\r\n  [id: string]: object\r\n}\r\n\r\n/**\r\n * A map of typed entities.\r\n */\r\nexport type TypedEntities<TType> = {\r\n  [id: string]: TType\r\n}\r\n\r\n/**\r\n * The initial value of the state.\r\n */\r\nexport const initialState: EntitiesState = {}\r\n\r\n/**\r\n * Associates a given key with a given `id` for each provided entities.  If the\r\n * `id` already has an entry, it overrides the previous value.\r\n * @param state The state\r\n * @param type The type of the entities\r\n * @param entities The entities\r\n */\r\nexport function setEntities (state: EntitiesState, type: Type, entities: Entities): EntitiesState {\r\n  const oldEntities = state[type] || {}\r\n\r\n  return {\r\n    ...state,\r\n    [type]: {\r\n      ...oldEntities,\r\n      ...entities\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Removes the given `id`s from the map of entities.  If the entity with one of\r\n * the given `id` does not exist, do nothing.\r\n * @param state The state\r\n * @param type The type of the entities\r\n * @param ids The `id`s\r\n */\r\nexport function unsetEntities (state: EntitiesState, type: Type, ids: string[]): EntitiesState {\r\n  const oldEntities = state[type]\r\n\r\n  if (oldEntities == null) {\r\n    return state\r\n  }\r\n\r\n  const newEntities = {\r\n    ...oldEntities\r\n  }\r\n\r\n  for (const id of ids) {\r\n    delete newEntities[id]\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    [type]: newEntities\r\n  }\r\n}\r\n","import { Entities, Type } from './state'\r\n\r\nexport type Action = {\r\n  type: any\r\n}\r\n\r\n// #region SET_ENTITIES\r\n/**\r\n * The type of the `SetEntitiesAction`.\r\n */\r\nexport const SET_ENTITIES = Symbol('@@redux-entities/SET_ENTITY')\r\n\r\n/**\r\n * An action indicating the fact that the user wants to add entities to the\r\n * state.\r\n */\r\nexport interface SetEntitiesAction extends Action {\r\n  type: typeof SET_ENTITIES,\r\n  payload: {\r\n    type: Type,\r\n    entities: Entities\r\n  }\r\n}\r\n\r\n/**\r\n * Instructs the reducer the add the following entities of the given type to the\r\n * state.\r\n * @param type The type of the entities\r\n * @param entities The entities\r\n * @returns An `SetEntitiesAction`\r\n */\r\nexport function setEntities (type: Type, entities: Entities): SetEntitiesAction {\r\n  return {\r\n    type: SET_ENTITIES,\r\n    payload: {\r\n      type,\r\n      entities\r\n    }\r\n  }\r\n}\r\n// #endregion\r\n\r\n// #region UNSET_ENTITIES\r\n/**\r\n * The type of the `UnsetEntitiesAction`.\r\n */\r\nexport const UNSET_ENTITIES = Symbol('@@redux-entities/UNSET_ENTITIES')\r\n\r\n/**\r\n * An action indicating the fact that the user wants to remove entities from the\r\n * state by their `id`s.\r\n */\r\nexport interface UnsetEntitiesAction extends Action {\r\n  type: typeof UNSET_ENTITIES,\r\n  payload: {\r\n    type: Type,\r\n    ids: string[]\r\n  }\r\n}\r\n\r\n/**\r\n * Removes all the entities with the given `id`s for the given `type`.\r\n * @param type The type of the entities\r\n * @param ids The `id`s of the entities\r\n * @returns An `UnsetEntitiesAction`\r\n */\r\nexport function unsetEntities (type: Type, ids: string[]): UnsetEntitiesAction {\r\n  return {\r\n    type: UNSET_ENTITIES,\r\n    payload: {\r\n      type,\r\n      ids\r\n    }\r\n  }\r\n}\r\n// #endregion\r\n\r\n// #region Aliases\r\n/**\r\n * Indicates that the user wants to add a given entity to the state.\r\n * @param type The type\r\n * @param id  The `id`\r\n * @param entity The entity\r\n * @returns A `SetEntitiesAction`\r\n */\r\nexport function setEntity (type: Type, id: string, entity: object) {\r\n  return setEntities(type, { [id]: entity })\r\n}\r\n\r\n/**\r\n * Indicates that the user wants to remove an entity by it's given `id`.\r\n * @param type The type\r\n * @param id The `id`\r\n * @returns An `UnsetEntitiesAction`\r\n */\r\nexport function unsetEntity (type: Type, id: string) {\r\n  return unsetEntities(type, [id])\r\n}\r\n// #endregion\r\n\r\nexport type EntitiesAction\r\n  = SetEntitiesAction\r\n  | UnsetEntitiesAction\r\n","import { Action, EntitiesAction, SET_ENTITIES, UNSET_ENTITIES } from './actions'\r\nimport { EntitiesState, initialState, setEntities, unsetEntities } from './state'\r\n\r\n/**\r\n * The reducer for the entities.\r\n * @param state The state\r\n * @param action An action\r\n * @returns The new value of the state\r\n */\r\nexport function entitiesReducer (state: EntitiesState, action: EntitiesAction): EntitiesState {\r\n  switch (action.type) {\r\n    case SET_ENTITIES: {\r\n      return setEntities(state, action.payload.type, action.payload.entities)\r\n    }\r\n    case UNSET_ENTITIES: {\r\n      return unsetEntities(state, action.payload.type, action.payload.ids)\r\n    }\r\n    default: {\r\n      return state\r\n    }\r\n  }\r\n}\r\n","import { TypedEntities, Type } from './state'\r\nimport { setEntities, setEntity, unsetEntities, unsetEntity, SetEntitiesAction, UnsetEntitiesAction } from './actions'\r\n\r\n/**\r\n * Creates action creators for the given entity type.\r\n * @param type The type of the entity\r\n */\r\nexport function createActions<TEntity extends object> (type: Type) {\r\n  return {\r\n    setEntity (id: string, entity: TEntity) {\r\n      return setEntity(type, id, entity)\r\n    },\r\n    setEntities (entities: TypedEntities<TEntity>) {\r\n      return setEntities(type, entities)\r\n    },\r\n    unsetEntity (id: string) {\r\n      return unsetEntity(type, id)\r\n    },\r\n    unsetEntities (ids: string[]) {\r\n      return unsetEntities(type, ids)\r\n    }\r\n  }\r\n}\r\n","import { Action, SetEntitiesAction, SET_ENTITIES, UnsetEntitiesAction, UNSET_ENTITIES } from './actions'\r\nimport { Type } from './state'\r\n\r\n/**\r\n * Creates action matchers for a specific entity.\r\n * @param type The type of the entity\r\n */\r\nexport function createActionMatchers<TEntity extends object> (type: Type) {\r\n  function _isSetEntities (action: Action): action is SetEntitiesAction {\r\n    return action.type === SET_ENTITIES\r\n  }\r\n\r\n  function _isUnsetEntities (action: Action): action is UnsetEntitiesAction {\r\n    return action.type === UNSET_ENTITIES\r\n  }\r\n\r\n  function isSetEntities (action: Action): action is SetEntitiesAction {\r\n    return _isSetEntities(action) && action.payload.type === type\r\n  }\r\n\r\n  function isUnsetEntities (action: Action): action is UnsetEntitiesAction {\r\n    return _isUnsetEntities(action) && action.payload.type === type\r\n  }\r\n\r\n  function isSetEntity (id: string) {\r\n    return function (action: Action) {\r\n      return isSetEntities(action) && id in action.payload.entities\r\n    }\r\n  }\r\n\r\n  function isUnsetEntity (id: string) {\r\n    return function (action: Action) {\r\n      return isUnsetEntities(action) && action.payload.ids.indexOf(id) !== -1\r\n    }\r\n  }\r\n\r\n  return {\r\n    isSetEntities,\r\n    isUnsetEntities,\r\n    isSetEntity,\r\n    isUnsetEntity\r\n  }\r\n}\r\n","import { State, Type, entitiesKey } from './state'\r\n\r\n/**\r\n * Returns the entity with the given `type` and `id`.  If the entity does not\r\n * exist, return `null`.\r\n * @param state The state\r\n * @param type The type of the entity\r\n * @param id The id of the entity\r\n * @returns An entity or `null`\r\n */\r\nexport function getEntity (state: State, type: Type, id: string): object | null {\r\n  const entities = state[entitiesKey][type]\r\n\r\n  if (!entities) {\r\n    return null\r\n  }\r\n\r\n  return entities[id] as object || null\r\n}\r\n\r\n/**\r\n * Returns a list of entities for all `id` supplied in the `ids` array.  If the\r\n * `id` does not point to a valid entity, an error is throw.\r\n * @param state The state\r\n * @param type The type of the entities\r\n * @param ids An array of entity id\r\n * @returns An array of entities\r\n */\r\nexport function getEntities (state: State, type: Type, ids: string[]): object[] {\r\n  if (!hasType(state, type)) {\r\n    throw new Error(`Expected the \"${type}\" type to exist`)\r\n  }\r\n\r\n  return ids.map(function (id) {\r\n    const entity = getEntity(state, type, id)\r\n\r\n    if (entity == null) {\r\n      throw new Error(`Expected the \"${type}\" with identified by \"${id}\" to exist`)\r\n    }\r\n\r\n    return entity\r\n  })\r\n}\r\n\r\n/**\r\n * Returns a list of entities for all `id` supplied in the `ids` array.  If the\r\n * `id` does not point to a valid entity, it is ignored in the resulting array.\r\n * @param state The state\r\n * @param type The type of the entities\r\n * @param ids An array of entity id\r\n * @returns An array of entities\r\n */\r\nexport function getEntitiesSafe (state: State, type: Type, ids: string[]): object[] {\r\n  return ids.reduce<object[]>(function (entities, id) {\r\n    const entity = getEntity(state, type, id)\r\n\r\n    if (entity) {\r\n      entities.push(entity)\r\n    }\r\n\r\n    return entities\r\n  }, [])\r\n}\r\n\r\n/**\r\n * Indicates if an entity is present in the state by it's given `id`.\r\n * @param state The state\r\n * @param type The type of entity\r\n * @param id The `id` of the entity\r\n * @returns The entity's presence\r\n */\r\nexport function hasEntity (state: State, type: Type, id: string): boolean {\r\n  return getEntity(state, type, id) != null\r\n}\r\n\r\nfunction hasType (state: State, type: Type) {\r\n  return state[entitiesKey][type] != null\r\n}\r\n","import { State, entitiesKey, Type } from './state'\r\nimport { getEntity, getEntities, getEntitiesSafe, hasEntity } from './selectors'\r\n\r\n/**\r\n * Creates selectors partially applied for a given type.\r\n * @param type A unique key representing the type of entities\r\n */\r\nexport function createSelectors<TEntity extends object> (type: Type) {\r\n  return {\r\n    getEntity (state: State, id: string): TEntity | null {\r\n      return getEntity(state, type, id) as TEntity | null\r\n    },\r\n    getEntities (state: State, ids: string[]): TEntity[] {\r\n      return getEntities(state, type, ids) as TEntity[]\r\n    },\r\n    getEntitiesSafe (state: State, ids: string[]): TEntity[] {\r\n      return getEntitiesSafe(state, type, ids) as TEntity[]\r\n    },\r\n    hasEntity (state: State, id: string): boolean {\r\n      return hasEntity(state, type, id)\r\n    }\r\n  }\r\n}\r\n","import { SetEntitiesAction, UnsetEntitiesAction } from './actions'\r\nimport { entitiesKey } from './state'\r\nimport { entitiesReducer } from './reducer'\r\n\r\nimport { createActions } from './create-actions'\r\nimport { createActionMatchers } from './create-action-matchers'\r\nimport { createSelectors } from './create-selectors'\r\n\r\nexport function createEntityHelpers<TEntity extends object> (type: string | symbol) {\r\n  return {\r\n    matchers: createActionMatchers<TEntity>(type),\r\n    actions: createActions<TEntity>(type),\r\n    selectors: createSelectors<TEntity>(type)\r\n  }\r\n}\r\n\r\nexport { createActions } from './create-actions'\r\nexport { createActionMatchers } from './create-action-matchers'\r\nexport { createSelectors } from './create-selectors'\r\n\r\nexport const entities = {\r\n  [entitiesKey]: entitiesReducer\r\n}\r\n\r\nexport { entitiesReducer } from './reducer'\r\nexport { entitiesKey } from './state'\r\n"],"names":["setEntities","unsetEntities"],"mappings":"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"}